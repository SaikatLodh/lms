<!DOCTYPE html>
<html lang="en">
  <%- include('./layout/head.ejs') %>

  <body>
    <div id="wrapper">
      <%- include('./layout/sidebar.ejs') %>
      <div id="content-wrapper" class="d-flex flex-column">
        <div id="content">
          <%- include('./layout/navbar.ejs') %> <% if(success && success.length
          > 0) { %>
          <div
            class="alert alert-success text-center alert-dismissible fade show success-msg"
            role="alert"
          >
            <%= success %>
            <button
              type="button"
              class="close"
              data-dismiss="alert"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <% } %> <% if(error && error.length > 0) { %>
          <div
            class="alert alert-danger text-center alert-dismissible fade show error-msg"
            role="alert"
          >
            <%= error %>
            <button
              type="button"
              class="close"
              data-dismiss="alert"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <% } %>

          <div class="container-fluid my-4">
            <div class="row">
              <div class="col-lg-6">
                <h1 class="h3 text-gray-800 mb-2">Manage Lectures</h1>
                <h4 class="text-gray-800 mb-4 manage-size">
                  Total Lectures:
                  <span id="total-courses-count"><%= lectures.length %></span>
                </h4>
              </div>

              <div class="col-lg-6 d-flex justify-content-end">
                <div class="search-container position-relative">
                  <div class="input-group">
                    <input
                      type="text"
                      id="lecture-search"
                      class="form-control border-primary"
                      placeholder="Search lectures by title, description..."
                      aria-label="Search lectures"
                    />
                  </div>
                </div>
              </div>
            </div>
            <div class="row g-4">
              <% if (lectures && lectures.length > 0) { %> <%
              lectures.forEach((lecture) => { %>
              <div class="col-12 col-md-6 col-lg-4 mb-5">
                <div class="card shadow-lg border-0 rounded-3 h-100">
                  <video
                    src="<%= lecture.videos.url %>"
                    class="card-img-top rounded-top"
                    alt="<%= lecture.title %>"
                    style="height: 200px; object-fit: cover"
                  ></video>

                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title fw-bold text-primary mb-2">
                      <%= lecture.title %>
                    </h5>

                    <h6 class="text-muted mb-3"><%= lecture.description %></h6>

                    <div class="mt-auto d-flex course-card">
                      <a
                        href="/managesinglelecture/<%= lecture._id %>"
                        class="btn btn-outline-primary btn-sm w-50"
                      >
                        <i class="bi bi-pencil-square"></i> Edit
                      </a>
                      <form
                        action="/admin/deleteLecture/<%= lecture.courseId._id %>/<%= lecture._id %>"
                        method="POST"
                        onsubmit="return confirm('Are you sure you want to delete this lecture?')"
                        class="w-50"
                      >
                        <button
                          type="submit"
                          class="btn btn-outline-danger btn-sm w-100"
                        >
                          <i class="bi bi-trash"></i> Delete
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
              <% }); %> <% } else { %>
              <div class="col-12 text-center py-5">
                <div
                  class="d-flex flex-column align-items-center justify-content-center"
                >
                  <i
                    class="bi bi-play-circle text-muted"
                    style="font-size: 4rem; margin-bottom: 1rem"
                  ></i>
                  <h4 class="text-muted mb-2">No Lectures Found</h4>
                  <p class="text-muted">
                    There are no lectures available for this course.
                  </p>
                </div>
              </div>
              <% } %>
            </div>
          </div>
        </div>

        <%- include('./layout/footer.ejs') %>
      </div>
    </div>

    <a class="scroll-to-top rounded" href="#page-top">
      <i class="fas fa-angle-up"></i>
    </a>

    <!-- Bootstrap core JavaScript-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="/js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="/js/demo/datatables-demo.js"></script>

    <script>
      const successMessage = document.querySelector(".success-msg");
      const errorMessage = document.querySelector(".error-msg");

      if (successMessage) {
        setTimeout(function () {
          successMessage.style.display = "none";
        }, 5000);
      }

      if (errorMessage) {
        setTimeout(function () {
          errorMessage.style.display = "none";
        }, 5000);
      }
    </script>

    <script>
      (function () {
        const searchInput = document.getElementById("lecture-search");
        const clearBtn = document.getElementById("clear-search");
        const lecturesContainer = document.querySelector(".row.g-4");
        const totalCountElem = document.getElementById("total-courses-count");

        function normalizeText(text) {
          return text.toLowerCase().trim();
        }

        function filterLectures() {
          const query = normalizeText(searchInput.value);
          const lectureCards = lecturesContainer.querySelectorAll(
            ".col-12.col-md-6.col-lg-4.mb-5"
          );
          let visibleCount = 0;

          lectureCards.forEach((card) => {
            const title = normalizeText(
              card.querySelector(".card-title").textContent
            );
            const description = normalizeText(
              card.querySelector("h6.text-muted.mb-3").textContent
            );

            const combinedText = title + " " + description;

            if (combinedText.includes(query)) {
              card.style.display = "";
              visibleCount++;
            } else {
              card.style.display = "none";
            }
          });

          totalCountElem.textContent = visibleCount;
        }

        searchInput.addEventListener("input", () => {
          filterLectures();
          clearBtn.style.display = searchInput.value ? "inline-block" : "none";
        });

        clearBtn.addEventListener("click", () => {
          searchInput.value = "";
          filterLectures();
          clearBtn.style.display = "none";
          searchInput.focus();
        });
      })();
    </script>
  </body>
</html>
